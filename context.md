# Context

The purpose of this repository is to create the type stubs for the flywheel-sdk package as a package flywheel-stubs.

Dependencies are managed with `uv`.

The directory typings/flywheel contains type stubs as .pyi files generated by pylance with a couple of files updated by hand.
The goal is to update these type stubs so that they can be used to type check code that uses the flywheel-sdk package.
Note that pylance copies some type information from the package as a comment.

The directory mypy-stubs/flywheel contains hand-curated stubs that are known to be sufficient.
Note that it is not necessary for the types to completely match those defined in the flywheel code.
In some cases, treating a type as a generic may be appropriate, for instance the definition of Finder in typings/flywheel/finder.pyi.

The file main.py was used to setup for pylance to generate the stubs in typings/flywheel.
This file could be used to create example code for evaluating the type stubs.

Please restrict changes to the directory typings/flywheel and the file main.py.
Ask before changing other files.

## Current State and Improvements Made

### Recent Updates (December 2024)

The type stubs in `typings/flywheel` have been significantly improved:

#### 1. Core Files Enhanced
- **`finder.pyi`**: Cleaned up unused imports, maintained comprehensive generic typing
- **`client.pyi`**: Major enhancement with proper type annotations, added missing methods from hand-curated version
- **`__init__.pyi`**: Streamlined from 702+ warnings to 49 warnings by focusing on essential exports

#### 2. Model Classes Improved
Key model classes transformed from simple aliases to comprehensive class definitions:
- **`project.pyi`**: Full class with constructor, properties (id, label, description, tags, info, etc.), and methods (add_permission, get_file, upload_file, etc.)
- **`session.pyi`**: Complete class with session-specific properties and methods
- **`subject.pyi`**: Full class with subject-specific properties and methods

#### 3. Testing Enhanced
- **`main.py`**: Expanded with comprehensive test functions covering all major operations
- Tests include: basic client usage, CRUD operations, data views, finder operations, file handling, etc.

#### 4. Key Improvements
- **Type Safety**: Added proper type annotations throughout
- **Practical Usability**: Method signatures match real-world usage patterns
- **Error Reduction**: Significantly reduced diagnostic warnings and errors
- **Comprehensive Coverage**: Maintained broad coverage while improving quality

### Known Issues and Areas for Future Work

#### 1. Remaining Warnings
- `typings/flywheel/__init__.pyi`: 49 warnings (mostly unused imports that may be needed for completeness)
- Various model files may still have unused imports that could be cleaned up

#### 2. Model Classes That May Need Enhancement
Most model classes in `typings/flywheel/models/` are still simple aliases that could benefit from full class definitions like Project, Session, and Subject. Priority candidates:
- `acquisition.pyi`
- `group.pyi`
- `user.pyi`
- `job.pyi`
- `gear.pyi`
- `file_entry.pyi`

#### 3. Pandas Dependency
The `read_view_dataframe` method requires pandas but we use `TYPE_CHECKING` imports to avoid hard dependency. This is handled correctly but worth noting.

#### 4. Missing Type Imports
Some imports like `flywheel.typing.role_assignment` don't exist in the actual package, so we use `Any` as fallback.

### Development Guidelines

#### When Adding New Model Classes:
1. Reference the hand-curated versions in `mypy-stubs/flywheel/models/` for guidance
2. Include constructor signatures with proper parameter types
3. Add property definitions with correct return types
4. Include common methods like `get_file()`, `update()`, `reload()`, etc.
5. Use generic types where appropriate (e.g., `Finder[T]` for collections)

#### When Cleaning Up Imports:
1. Be cautious about removing imports from `__init__.pyi` - they may be needed for public API
2. Check actual usage patterns in the flywheel-sdk documentation
3. Test with real code examples to ensure nothing breaks

#### Testing Strategy:
1. Use `main.py` to add comprehensive examples of new functionality
2. Run diagnostics regularly to catch type errors early
3. Test with actual flywheel-sdk usage patterns when possible

### Diagnostic Status
- **Before improvements**: 702+ warnings in `__init__.pyi`, multiple errors across files
- **Current state**: 49 warnings in `__init__.pyi`, no critical errors in main type stub files
- **Target**: Continue reducing warnings while maintaining comprehensive coverage

### Tools and Commands
- `uv run python main.py` - Run test examples
- Type checking can be done with mypy, pyright, or other type checkers
- The stubs are designed to work with the actual flywheel-sdk package